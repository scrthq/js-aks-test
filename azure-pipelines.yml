variables:
  - group: deployment-vars

trigger:
  branches:
    include:
      - main
      - dev

pr: none

stages:
  - stage: preview
    displayName: pulumi preview
    variables:
      PULUMI_ACCESS_TOKEN: $(PULUMI_ACCESS_TOKEN_SECRET)
    jobs:
      - job: preview
        pool:
          vmImage: ubuntu-latest
          container: pulumi/pulumi-python:latest
        dependsOn: []
        displayName: pulumi preview
        steps:
          - task: Cache@2
            displayName: Use cached venv
            inputs:
              key: '$(Build.Repository.Name)_$(Build.SourceBranchName)_venv'
              path: venv
              cacheHitVar: VENV_CACHE_RESTORED
          - script: pulumi version
          - task: Pulumi@1
            inputs:
              azureSubscription: 'Free Trial(9589b86c-0184-4e83-995c-559cbf7b723a)'
              command: 'preview'
              stack: '$(Build.SourceBranchName)'
          